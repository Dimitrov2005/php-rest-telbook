class ClientData {	constructor() {		this.person_id = null;		this.persons = null;		this.telephones = null;		this.teltypes = null;	}	getCurrentPerson() {		return this.getPerson(this.person_id);	}		getPerson(person_id) {		for(var i=0; i < this.persons.length; i++) {			if(this.persons[i].id == person_id) {				return this.persons[i];			}		}		return null;	}	getTelephone(telephone_id) {		for(var i=0; i < this.telephones.length; i++) {			if(this.telephones[i].id == telephone_id) {				return this.telephones[i];			}		}		return null;	}		getTelType(id) {		for(var i=0; i < this.teltypes.length; i++) {			if(this.teltypes[i].id == id) {				return this.teltypes[i];			}		}		return null;	}		loadTeltypes() {		var self = this;		$.get('teltypes').done(function(data) {			self.teltypes = data.teltypes;		});	}}// PERSONSfunction reload_persons() {	$.get('persons').done(function(data) {		DATA.persons = data.persons;		render_persons();	}).fail(function(response) {		var data = response.responseJSON;		$('#persons').html(render_messages(data.messages));	});}function render_persons() {	var html = '';	html += "<table class='grid'>";	html += "<tr><th>ID</th><th>NAME</th><th>ADDRESS</th><th></th></tr>";	for(var i=0; i<DATA.persons.length; i++) {		var p = DATA.persons[i];		var css = (DATA.person_id === p.id) ? 'selected' : '';		html += "<tr class='" + css + "'>" +			"<td>" + p.id + "</td>" +			"<td><a href='#' data-id='" + p.id + "' class='icon user_icon person-telephones'>" +				html_escape(p.fname + " " + p.lname) +			"</a></td>"+			"<td>" + html_escape(p.address) + "</td>" +			"<td>" +				"<a href='#' data-id='" + p.id + "' class='icon edit_icon person-edit'>Edit</a> " +				"<a href='#' data-id='" + p.id + "' class='icon delete_icon person-delete'>Delete</a>" +			"</td>" +		"</tr>";	}	html += "</table>";	$('#persons').html(html);}	function render_person_form(person) {	var html = '';	var title = (person.id) ? 'Edit Person' : 'Add Person';		html += "<h1>" + title + "</h1>";	html += "<form id='person-edit-form' action='#' method='post'>";	html += "<p><label>ID</label><input name='id' class='txt medium' value='" + html_escape(person.id) + "' readonly /></p>";	html += "<p><label>FNAME</label><input name='fname' class='txt medium' value='" + html_escape(person.fname) + "'/></p>";	html += "<p><label>LNAME</label><input name='lname' class='txt medium' value='" + html_escape(person.lname) + "'/></p>";	html += "<p><label>ADDRESS</label><input name='address' class='txt medium' value='" + html_escape(person.address) + "'/></p>";	html += "<p><button>Save</button></p>";	html += "</form>";		return html;}// TELEPHONESfunction reload_telephones() {	var p = DATA.getCurrentPerson();	if(p) {		$.get('persons/' + p.id + '/telephones').done(function(data) {			DATA.telephones = data.telephones;			render_telephones();		}).fail(function(response) {			var data = response.responseJSON;			$('#telephones').html(render_messages(data.messages));		});	}	else {		$('#telephones').html("");	}}function render_telephones() {	var p = DATA.getCurrentPerson();	var html = '';	html += "<p class='icon user_icon'>" + html_escape(p.fname + " " + p.lname) + "</p>";	html += "<table class='grid'>";	html += "<tr><th>ID</td><th>NUMBER</th><th>TYPE</th><th></th></tr>";	for(var i=0; i<DATA.telephones.length; i++) {		var tel = DATA.telephones[i];		html += "<tr>"+			"<td>" + tel.id + "</td>" +			"<td>" + html_escape(tel.number) + "</td>" +			"<td>" + html_escape(DATA.getTelType(tel.teltype_id).name) + "</td>" +			"<td>" +				"<a href='#' data-id='" + tel.id + "' class='icon edit_icon telephone-edit'>Edit</a> " +				"<a href='#' data-id='" + tel.id + "' class='icon delete_icon telephone-delete'>Delete</a>" +			"</td>"+		"</tr>";	}	html += "</table>";	html += "<p>" +		"<a href='#' data-id='" + p.id + "' class='icon add_icon telephone-add'>Add New Telephone</a> " +		"<a href='#' data-id='" + p.id + "' class='icon refresh_icon telephones-refresh'>Refresh</a>" +		"</p>";	$('#telephones').html(html);}function render_telephone_form(telephone) {	var html = '';	var title = (telephone.ID) ? 'Edit Telephone' : 'Add Telephone';		html += "<h1>" + title + "</h1>";	html += "<form id='telephone-edit-form' action='#' method='post'>";	html += "<p><label>ID</label><input name='id' class='txt medium' value='" + html_escape(telephone.id) + "' readonly /></p>";	html += "<p><label>PID</label><input name='person_id' class='txt medium' value='" + html_escape(telephone.person_id) + "' readonly /></p>";	html += "<p><label>NOMER</label><input name='number' class='txt medium' value='" + html_escape(telephone.number) + "'/></p>";		html += "<p><label>TYPE</label>";	html += "<select name='teltype_id' class='txt medium'>";	html += "<option value=''> </option>";	for(var i = 0; i < DATA.teltypes.length; i++) {		var tt = DATA.teltypes[i];		var selected = (telephone.teltype_id === tt.id) ? 'selected' : '';		html += "<option value='" + tt.id + "' " + selected + ">" + tt.name + "</option>";	}	html += "</select>";	html += "</p>";	html += "<p><button>Save</button></p>";	html += "</form>";		return html;}function render_messages(messages) {	var html = '';	if(messages) {			for(var i = 0; i < messages.length; i++) {			var m = messages[i];			var css = (m.type === 'error') ? 'icon error_icon error' : 'icon info_icon info';			html += "<p class='" + css + "'>" + m.text + "</p>";		}	}	return html;}function html_escape(val) {	return (val+'')      .replace(/&/g, '&amp;')      .replace(/</g, '&lt;')      .replace(/>/g, '&gt;')      .replace(/\"/g, '&quot;')      .replace(/\'/g, '&apos;');}